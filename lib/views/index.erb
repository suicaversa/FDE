<% if session['access_token'].nil? %>
  <a href="/login">Login</a>
<% end %>


<% if session['access_token'] %>
  You are logged in! <a href="/logout">Logout</a>
<% end %>


<% if session['access_token'] %>
  <form class="query" method="get" action="/fetch">
    <input type="date" name="query[since]" value="<%= (params[:query] && params[:query][:since]) || (Date.today - 30).to_s %>">
    <input type="date" name="query[until]" value="<%= (params[:query] && params[:query][:until]) || (Date.today).to_s %>">
    <button>取得</button>
  </form>

  <ul class="filelist"></ul>
<% end %>

<script>
  $(function(){
      $.ajax({
        url: "./list"
      }).done(function(data){
        $('.filelist').html(data);
        console.log("Ajax: Successfully fetched.");
      }).fail(function( jqXHR, textStatus ) {
        console.log( "Ajax: Request failed: " + textStatus );
      });;
  });
</script>
